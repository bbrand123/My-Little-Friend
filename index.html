<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pet Care Buddy - A fun virtual pet care game for all ages!">
    <meta name="theme-color" content="#A8D8EA">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cellipse cx='50' cy='65' rx='22' ry='18' fill='%23F8BBD0'/%3E%3Ccircle cx='28' cy='35' r='12' fill='%23F8BBD0'/%3E%3Ccircle cx='72' cy='35' r='12' fill='%23F8BBD0'/%3E%3Ccircle cx='18' cy='18' r='10' fill='%23F8BBD0'/%3E%3Ccircle cx='82' cy='18' r='10' fill='%23F8BBD0'/%3E%3C/svg%3E">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Pet Buddy">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <title>Pet Care Buddy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Splash/Loading Screen (shown immediately, dismissed by JS after init) -->
    <div id="splash-screen" role="status" aria-label="Loading Pet Care Buddy" style="position:fixed;inset:0;z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#FFF8F0,#A8D8EA);transition:opacity 0.3s ease;">
        <svg class="splash-egg" viewBox="0 0 100 130" width="80" height="104" aria-hidden="true" style="animation:splashBounce 1s ease-in-out infinite;">
            <defs>
                <linearGradient id="splashEggGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#FFDDE1"/>
                    <stop offset="50%" style="stop-color:#F8BBD0"/>
                    <stop offset="100%" style="stop-color:#FFDDE1"/>
                </linearGradient>
                <linearGradient id="splashEggShine" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.6"/>
                    <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0"/>
                </linearGradient>
            </defs>
            <ellipse cx="50" cy="70" rx="40" ry="50" fill="url(#splashEggGrad)" stroke="#CE93D8" stroke-width="3"/>
            <circle cx="35" cy="50" r="8" fill="#CE93D8" opacity="0.7"/>
            <circle cx="65" cy="45" r="6" fill="#CE93D8" opacity="0.7"/>
            <circle cx="55" cy="80" r="7" fill="#CE93D8" opacity="0.7"/>
            <ellipse cx="35" cy="45" rx="15" ry="20" fill="url(#splashEggShine)"/>
        </svg>
        <p style="margin-top:16px;font-family:'Nunito',sans-serif;font-size:1.3rem;font-weight:700;color:#5D4037;">Pet Care Buddy</p>
        <p style="margin-top:4px;font-family:'Nunito',sans-serif;font-size:0.85rem;color:#8D6E63;">Loading...</p>
    </div>
    <style>
        @keyframes splashBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }
        @media (prefers-reduced-motion: reduce) {
            .splash-egg { animation: none !important; }
        }
        @media (prefers-color-scheme: dark) {
            #splash-screen { background: linear-gradient(135deg, #1a1a2e, #16213e) !important; }
            #splash-screen p { color: #e0e0e0 !important; }
        }
    </style>
    <script>
        (function setupSplashFallback() {
            const MIN_SHOW_MS = 800;
            const HARD_TIMEOUT_MS = 5000;
            const startedAt = Date.now();
            let dismissed = false;

            function dismissSplashScreen(options) {
                if (dismissed) return;
                const opts = options || {};
                const splash = document.getElementById('splash-screen');
                if (!splash) {
                    dismissed = true;
                    return;
                }
                const elapsed = Date.now() - startedAt;
                const waitMs = opts.skipMinDelay ? 0 : Math.max(0, MIN_SHOW_MS - elapsed);
                dismissed = true;
                setTimeout(() => {
                    splash.setAttribute('aria-hidden', 'true');
                    splash.style.pointerEvents = 'none';
                    splash.style.opacity = '0';
                    setTimeout(() => {
                        if (splash.parentNode) splash.remove();
                    }, 320);
                }, waitMs);
            }

            window.dismissSplashScreen = dismissSplashScreen;
            document.addEventListener('DOMContentLoaded', () => dismissSplashScreen(), { once: true });
            window.addEventListener('load', () => dismissSplashScreen(), { once: true });
            setTimeout(() => dismissSplashScreen({ skipMinDelay: true }), HARD_TIMEOUT_MS);
        })();
    </script>

    <a href="#game-content" class="skip-link">Skip to game</a>
    <a href="#care-actions" class="skip-link skip-link-secondary" hidden aria-hidden="true" tabindex="-1">Skip to care actions</a>
    <a href="#room-nav" class="skip-link skip-link-rooms" hidden aria-hidden="true" tabindex="-1">Skip to rooms</a>
    <a href="#status-heading" class="skip-link skip-link-status" hidden aria-hidden="true" tabindex="-1">Skip to status</a>
    <main class="game-container">
        <header class="game-header">
            <h1 class="game-title">Pet Care Buddy</h1>
        </header>

        <div id="game-content" role="region" aria-label="Game content">
            <!-- Game content will be dynamically inserted here -->
        </div>

        <!-- Live region for screen reader announcements -->
        <div id="live-announcer" class="live-region" aria-live="polite"></div>
        <div id="live-announcer-assertive" class="live-region" aria-live="assertive" aria-atomic="true"></div>

        <!-- Toast notification container (visual only; screen reader announcements go through #live-announcer) -->
        <div id="toast-container"></div>
    </main>

    <!-- Load JavaScript modules -->
    <script src="js/version.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/balance.js"></script>
    <script src="js/eventbus.js"></script>
    <script src="js/state.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/modal-manager.js"></script>
    <script src="js/svg.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/minigames.js"></script>
    <script src="js/competition.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(function(reg) {
                // F40: Update detection
                reg.addEventListener('updatefound', function() {
                    var newWorker = reg.installing;
                    if (newWorker) {
                        newWorker.addEventListener('statechange', function() {
                            if (newWorker.state === 'activated' && navigator.serviceWorker.controller) {
                                var banner = document.createElement('div');
                                banner.className = 'offline-update-banner';
                                banner.setAttribute('role', 'status');
                                banner.innerHTML = 'A new version is available. <button onclick="location.reload()" style="background:none;border:1px solid;padding:2px 8px;border-radius:4px;cursor:pointer;font-weight:700;color:inherit;margin-left:6px;">Refresh</button> <button onclick="this.parentNode.remove()" aria-label="Dismiss" style="background:none;border:none;cursor:pointer;font-weight:700;color:inherit;margin-left:4px;">âœ•</button>';
                                document.body.appendChild(banner);
                            }
                        });
                    }
                });
            }).catch(function() {});
        }
        // F40: Online/offline status
        window.addEventListener('offline', function() {
            var existing = document.querySelector('.offline-update-banner');
            if (existing) existing.remove();
            var banner = document.createElement('div');
            banner.className = 'offline-update-banner offline-banner';
            banner.setAttribute('role', 'status');
            banner.setAttribute('aria-live', 'polite');
            banner.textContent = "You're playing offline. Progress will sync when you reconnect.";
            document.body.appendChild(banner);
        });
        window.addEventListener('online', function() {
            var banner = document.querySelector('.offline-banner');
            if (banner) banner.remove();
            if (typeof showToast === 'function') showToast('Back online!', '#66BB6A');
        });
    </script>
</body>
</html>
