<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet Care Buddy - Virtual Pet Game for Kids</title>
    <style>
        /* CSS Reset and Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            /* Bright, cheerful color palette with high contrast */
            --color-bg: #FFF8E7;
            --color-primary: #FF6B6B;
            --color-secondary: #4ECDC4;
            --color-accent: #FFE66D;
            --color-happy: #95E86F;
            --color-neutral: #FFB347;
            --color-sad: #FF6B6B;
            --color-text: #2D3436;
            --color-text-light: #FFFFFF;
            --color-button-feed: #FF8C42;
            --color-button-wash: #4FC3F7;
            --color-button-play: #AED581;
            --color-button-sleep: #9575CD;
            --color-button-medicine: #F48FB1;
            --color-button-groom: #CE93D8;
            --color-button-exercise: #FFB74D;
            --color-button-treat: #FF7EB3;
            --color-button-pet: #FFB4A2;
            --color-hunger: #FF7043;
            --color-clean: #29B6F6;
            --color-happy-bar: #66BB6A;
            --color-energy: #FFD54F;
            --shadow: 0 4px 15px rgba(0,0,0,0.15);
            --radius: 20px;
            --focus-outline: 4px solid #6C63FF;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, var(--color-bg) 0%, #FFE4E1 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--color-text);
            line-height: 1.4;
        }

        /* Skip link for keyboard users */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--color-primary);
            color: white;
            padding: 10px 20px;
            z-index: 100;
            border-radius: 0 0 10px 0;
            font-weight: bold;
            text-decoration: none;
        }

        .skip-link:focus {
            top: 0;
            outline: var(--focus-outline);
        }

        /* Focus styles for accessibility */
        *:focus {
            outline: var(--focus-outline);
            outline-offset: 3px;
        }

        *:focus:not(:focus-visible) {
            outline: none;
        }

        *:focus-visible {
            outline: var(--focus-outline);
            outline-offset: 3px;
        }

        /* Main Game Container */
        .game-container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        /* Header */
        .game-header {
            margin-bottom: 10px;
        }

        .game-title {
            font-size: 1.8rem;
            color: var(--color-primary);
            text-shadow: 2px 2px 0 var(--color-accent);
            margin-bottom: 5px;
        }

        /* Pet Display Area */
        .pet-area {
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            border-radius: var(--radius);
            padding: 20px 20px 25px;
            margin: 8px 0;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        /* Ground */
        .pet-area::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(180deg, #7CB342 0%, #558B2F 100%);
            border-radius: 0 0 var(--radius) var(--radius);
        }

        /* Pet Container */
        .pet-container {
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease;
        }

        .pet-container.bounce {
            animation: bounce 0.5s ease;
        }

        .pet-container.wiggle {
            animation: wiggle 0.5s ease;
        }

        .pet-container.sparkle {
            animation: sparkle 0.6s ease;
        }

        .pet-container.sleep-anim {
            animation: sleepBob 0.8s ease;
        }

        .pet-container.groom-anim {
            animation: groomPreen 0.8s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-30px); }
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3); }
        }

        @keyframes sleepBob {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-3deg); }
            75% { transform: translateY(-5px) rotate(3deg); }
        }

        @keyframes groomPreen {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-5deg); }
            50% { transform: scale(1.08) rotate(0deg); }
            75% { transform: scale(1.05) rotate(5deg); }
        }

        .pet-container.treat-anim {
            animation: treatBounce 0.8s ease;
        }

        @keyframes treatBounce {
            0%, 100% { transform: scale(1) translateY(0); }
            30% { transform: scale(1.1) translateY(-15px); }
            50% { transform: scale(1.05) translateY(-5px); }
            70% { transform: scale(1.12) translateY(-10px); }
        }

        .pet-container.cuddle-anim {
            animation: cuddleNuzzle 0.8s ease;
        }

        @keyframes cuddleNuzzle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            15% { transform: scale(1.08) rotate(-3deg); }
            30% { transform: scale(1.12) rotate(2deg); }
            45% { transform: scale(1.1) rotate(-2deg); }
            60% { transform: scale(1.12) rotate(1deg); }
            75% { transform: scale(1.08) rotate(-1deg); }
        }

        .pet-container.exercise-anim {
            animation: exerciseRun 0.8s ease;
        }

        @keyframes exerciseRun {
            0% { transform: translateX(0); }
            20% { transform: translateX(-15px) translateY(-5px); }
            40% { transform: translateX(15px) translateY(-8px); }
            60% { transform: translateX(-10px) translateY(-3px); }
            80% { transform: translateX(10px) translateY(-5px); }
            100% { transform: translateX(0); }
        }

        /* Pet SVG Styles */
        .pet-svg {
            width: 150px;
            height: 150px;
            transition: all 0.3s ease;
        }

        /* Egg Styles */
        .egg-container {
            cursor: pointer;
            transition: transform 0.1s ease;
            background: transparent;
            border: none;
            padding: 10px;
            border-radius: 20px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .egg-container:hover,
        .egg-container:focus {
            transform: scale(1.05);
            background: rgba(255,255,255,0.2);
        }

        .egg-container:active {
            transform: scale(0.95);
        }

        .egg-svg {
            width: 120px;
            height: 160px;
        }

        .egg-crack {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .egg-shake {
            animation: eggShake 0.3s ease;
        }

        @keyframes eggShake {
            0%, 100% { transform: rotate(0deg); }
            20% { transform: rotate(-5deg); }
            40% { transform: rotate(5deg); }
            60% { transform: rotate(-5deg); }
            80% { transform: rotate(5deg); }
        }

        .hatch-message {
            font-size: 1.5rem;
            color: var(--color-text);
            margin-top: 15px;
            font-weight: bold;
        }

        .tap-hint {
            font-size: 1.2rem;
            color: var(--color-text);
            margin-top: 10px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Pet Name Display */
        .pet-name {
            font-size: 1.4rem;
            color: var(--color-primary);
            font-weight: bold;
            margin-top: 8px;
            text-shadow: 1px 1px 0 var(--color-accent);
        }

        .pet-mood {
            font-size: 0.95rem;
            color: var(--color-text);
            margin-top: 2px;
        }

        /* Needs Section - Compact Circular Indicators */
        .needs-section {
            margin: 10px 0 5px;
        }

        .needs-row {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .need-bubble {
            position: relative;
            width: 58px;
            height: 58px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            transition: transform 0.2s ease;
        }

        .need-bubble:hover {
            transform: scale(1.1);
        }

        .need-bubble-ring {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: conic-gradient(var(--ring-color) calc(var(--progress) * 1%), #e0e0e0 0);
            mask: radial-gradient(farthest-side, transparent calc(100% - 5px), #fff calc(100% - 4.5px));
            -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 5px), #fff calc(100% - 4.5px));
            transition: background 0.5s ease;
        }

        .need-bubble-icon {
            font-size: 1.5rem;
            z-index: 1;
            line-height: 1;
        }

        .need-bubble-value {
            position: absolute;
            bottom: -16px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--color-text);
            white-space: nowrap;
        }

        .need-bubble.low .need-bubble-icon {
            animation: needPulse 1.5s ease-in-out infinite;
        }

        @keyframes needPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        /* Action Buttons - Horizontal Scrolling Strip */
        .actions-section {
            margin-top: 10px;
        }

        .action-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 8px 4px 12px;
            scroll-snap-type: x proximity;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: rgba(0,0,0,0.15) transparent;
        }

        .action-scroll::-webkit-scrollbar {
            height: 4px;
        }

        .action-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .action-scroll::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.15);
            border-radius: 4px;
        }

        .action-btn {
            min-width: 68px;
            min-height: 68px;
            width: 68px;
            height: 68px;
            flex-shrink: 0;
            border: none;
            border-radius: 18px;
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            transition: all 0.2s ease;
            box-shadow: 0 3px 8px rgba(0,0,0,0.18);
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            font-family: inherit;
            scroll-snap-align: start;
        }

        .action-btn:hover,
        .action-btn:focus {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 12px rgba(0,0,0,0.25);
        }

        .action-btn:active {
            transform: translateY(0) scale(0.97);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn.cooldown {
            pointer-events: none;
            opacity: 0.7;
        }

        .action-btn.feed {
            background: linear-gradient(135deg, var(--color-button-feed), #F57C00);
        }

        .action-btn.wash {
            background: linear-gradient(135deg, var(--color-button-wash), #0288D1);
        }

        .action-btn.play {
            background: linear-gradient(135deg, var(--color-button-play), #7CB342);
        }

        .action-btn.sleep {
            background: linear-gradient(135deg, var(--color-button-sleep), #7E57C2);
        }

        .action-btn.medicine {
            background: linear-gradient(135deg, var(--color-button-medicine), #EC407A);
        }

        .action-btn.groom {
            background: linear-gradient(135deg, var(--color-button-groom), #AB47BC);
        }

        .action-btn.exercise {
            background: linear-gradient(135deg, var(--color-button-exercise), #FF9800);
        }

        .action-btn.treat {
            background: linear-gradient(135deg, var(--color-button-treat), #FF4081);
        }

        .action-btn.pet-cuddle {
            background: linear-gradient(135deg, var(--color-button-pet), #E88B73);
        }

        .btn-icon {
            font-size: 1.6rem;
            line-height: 1;
        }

        /* Feedback Messages */
        .feedback-area {
            min-height: 28px;
            margin: 6px 0 4px;
        }

        .feedback-message {
            font-size: 1.1rem;
            color: var(--color-happy);
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            animation: feedbackPop 0.5s ease;
        }

        .feedback-message.show {
            opacity: 1;
        }

        @keyframes feedbackPop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* New Pet Button */
        .new-pet-btn {
            margin-top: 8px;
            padding: 10px 22px;
            font-size: 0.85rem;
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
        }

        .new-pet-btn:hover,
        .new-pet-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Screen Reader Only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Live Region for Screen Readers */
        .live-region {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Sparkle Effect */
        .sparkles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .sparkle-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--color-accent);
            border-radius: 50%;
            animation: sparkleFloat 1s ease-out forwards;
        }

        @keyframes sparkleFloat {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            100% {
                opacity: 0;
                transform: scale(0) translateY(-50px);
            }
        }

        /* Hearts for Play */
        .heart-particle {
            position: absolute;
            font-size: 1.5rem;
            animation: heartFloat 1s ease-out forwards;
        }

        @keyframes heartFloat {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) translateY(-60px);
            }
        }

        /* Bubbles for Wash */
        .bubble-particle {
            position: absolute;
            width: 15px;
            height: 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            border: 2px solid rgba(100,200,255,0.5);
            animation: bubbleFloat 1.2s ease-out forwards;
        }

        @keyframes bubbleFloat {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) translateY(-70px);
            }
        }

        /* Zzz particles for Sleep */
        .zzz-particle {
            position: absolute;
            font-size: 1.5rem;
            font-weight: bold;
            color: #9575CD;
            animation: zzzFloat 1.5s ease-out forwards;
        }

        @keyframes zzzFloat {
            0% {
                opacity: 1;
                transform: scale(0.5) translateY(0) translateX(0);
            }
            50% {
                opacity: 1;
                transform: scale(1) translateY(-30px) translateX(10px);
            }
            100% {
                opacity: 0;
                transform: scale(1.2) translateY(-60px) translateX(20px);
            }
        }

        /* Star particles for Sleep */
        .star-particle {
            position: absolute;
            font-size: 1.2rem;
            animation: starTwinkle 1.2s ease-out forwards;
        }

        @keyframes starTwinkle {
            0% {
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) rotate(360deg);
            }
        }

        /* Medicine healing particles */
        .medicine-particle {
            position: absolute;
            font-size: 1.3rem;
            animation: medicineFloat 1.3s ease-out forwards;
        }

        @keyframes medicineFloat {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(0);
            }
            30% {
                opacity: 1;
                transform: scale(1.2) translateY(-20px);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
        }

        .pet-container.heal-anim {
            animation: healPulse 0.8s ease;
        }

        @keyframes healPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            25% { transform: scale(1.05); filter: brightness(1.1) hue-rotate(10deg); }
            50% { transform: scale(1.08); filter: brightness(1.2) hue-rotate(0deg); }
            75% { transform: scale(1.05); filter: brightness(1.1) hue-rotate(-10deg); }
        }

        /* Grooming particles */
        .groom-particle {
            position: absolute;
            font-size: 1.3rem;
            animation: groomFloat 1.3s ease-out forwards;
        }

        @keyframes groomFloat {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(0) rotate(0deg);
            }
            30% {
                opacity: 1;
                transform: scale(1.2) translateY(-15px) rotate(10deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(-45px) rotate(-10deg);
            }
        }

        .exercise-particle {
            position: absolute;
            font-size: 1.3rem;
            animation: exerciseFloat 1.3s ease-out forwards;
        }

        @keyframes exerciseFloat {
            0% {
                opacity: 0;
                transform: scale(0.5) translateY(0) translateX(0);
            }
            30% {
                opacity: 1;
                transform: scale(1.2) translateY(-10px) translateX(10px);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(-40px) translateX(-15px);
            }
        }

        /* Treat particles */
        .treat-particle {
            position: absolute;
            font-size: 1.4rem;
            animation: treatFloat 1.4s ease-out forwards;
        }

        @keyframes treatFloat {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(0) rotate(0deg);
            }
            25% {
                opacity: 1;
                transform: scale(1.3) translateY(-15px) rotate(15deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.6) translateY(-55px) rotate(-15deg);
            }
        }

        /* Cuddle/petting particles */
        .cuddle-particle {
            position: absolute;
            font-size: 1.4rem;
            animation: cuddleFloat 1.4s ease-out forwards;
        }

        @keyframes cuddleFloat {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(0) rotate(0deg);
            }
            20% {
                opacity: 1;
                transform: scale(1.2) translateY(-10px) rotate(-10deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.4) translateY(-25px) rotate(5deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(-55px) rotate(-5deg);
            }
        }

        /* Pettable pet area cursor */
        .pet-container.pettable {
            cursor: pointer;
        }

        .pet-container.pettable:hover {
            filter: brightness(1.05);
        }

        /* Day/Night cycle styles */
        .pet-area.daytime {
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
        }

        .pet-area.sunset {
            background: linear-gradient(180deg, #FF7E5F 0%, #FEB47B 50%, #98FB98 100%);
        }

        .pet-area.nighttime {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .pet-area.nighttime::after {
            background: linear-gradient(180deg, #2d4a22 0%, #1a3015 100%);
        }

        .pet-area.sunrise {
            background: linear-gradient(180deg, #ffecd2 0%, #fcb69f 50%, #98FB98 100%);
        }

        /* Stars overlay for night */
        .stars-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 40px;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Moon for nighttime */
        .moon {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 35px;
            height: 35px;
            background: #FFFACD;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 250, 205, 0.6);
            z-index: 0;
        }

        /* Sun for daytime */
        .sun {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #FFD700;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            z-index: 0;
        }

        /* Time indicator */
        .time-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.2rem;
            z-index: 2;
        }

        /* Responsive Design */
        @media (max-width: 500px) {
            .game-container {
                padding: 15px;
                border-radius: 15px;
            }

            .game-title {
                font-size: 1.6rem;
            }

            .pet-area {
                padding: 15px;
                min-height: 180px;
            }

            .pet-svg {
                width: 120px;
                height: 120px;
            }

            .need-bubble {
                width: 50px;
                height: 50px;
            }

            .need-bubble-icon {
                font-size: 1.3rem;
            }

            .need-bubble-value {
                font-size: 0.6rem;
            }

            .action-btn {
                min-width: 60px;
                min-height: 60px;
                width: 60px;
                height: 60px;
                border-radius: 15px;
            }

            .btn-icon {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 350px) {
            .needs-row {
                gap: 8px;
            }

            .need-bubble {
                width: 44px;
                height: 44px;
            }

            .need-bubble-icon {
                font-size: 1.1rem;
            }

            .action-btn {
                min-width: 54px;
                min-height: 54px;
                width: 54px;
                height: 54px;
                font-size: 0.6rem;
            }

            .btn-icon {
                font-size: 1.2rem;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --color-text: #000000;
                --shadow: 0 4px 15px rgba(0,0,0,0.3);
            }

            .action-btn {
                border: 3px solid #000000;
            }

            .need-bubble {
                border: 2px solid #000000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Child-friendly modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 30px;
            max-width: 350px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: modalPop 0.3s ease;
        }

        @keyframes modalPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--color-text);
            margin-bottom: 10px;
        }

        .modal-message {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            min-width: 100px;
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .modal-btn.confirm {
            background: linear-gradient(135deg, #FF6B6B, #EE5A5A);
            color: white;
        }

        .modal-btn.cancel {
            background: linear-gradient(135deg, #4ECDC4, #45B7AA);
            color: white;
        }

        .modal-btn:hover,
        .modal-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

    </style>
</head>
<body>
    <a href="#main-game" class="skip-link">Skip to game</a>

    <main id="main-game" class="game-container" role="main" aria-label="Pet Care Buddy Game">
        <header class="game-header">
            <h1 class="game-title">Pet Care Buddy</h1>
        </header>

        <div id="game-content">
            <!-- Game content will be dynamically inserted here -->
        </div>

        <!-- Live region for screen reader announcements -->
        <div id="live-announcer" class="live-region" aria-live="polite" aria-atomic="true"></div>
        <div id="live-announcer-assertive" class="live-region" aria-live="assertive" aria-atomic="true"></div>
    </main>

    <script>
        // Pet Care Buddy Game - Main JavaScript

        // ==================== GAME DATA ====================

        const PET_TYPES = {
            dog: {
                name: 'Puppy',
                emoji: 'ðŸ•',
                colors: ['#D4A574', '#8B7355', '#F5DEB3', '#A0522D', '#FFE4C4'],
                sounds: ['Woof!', 'Bark!', 'Arf!'],
                happySounds: ['Happy bark!', 'Tail wagging!', 'Playful woof!'],
                sadSounds: ['Whimper...', 'Sad whine...']
            },
            cat: {
                name: 'Kitty',
                emoji: 'ðŸ±',
                colors: ['#FFA500', '#808080', '#FFFFFF', '#000000', '#DEB887'],
                sounds: ['Meow!', 'Purr!', 'Mew!'],
                happySounds: ['Loud purring!', 'Happy meow!', 'Content purr!'],
                sadSounds: ['Sad meow...', 'Quiet mew...']
            },
            bunny: {
                name: 'Bunny',
                emoji: 'ðŸ°',
                colors: ['#FFFFFF', '#D4A574', '#808080', '#F5DEB3', '#FFB6C1'],
                sounds: ['Hop hop!', 'Sniff sniff!', 'Thump!'],
                happySounds: ['Binky jump!', 'Happy hop!', 'Excited thump!'],
                sadSounds: ['Quiet sniff...', 'Slow hop...']
            },
            bird: {
                name: 'Birdie',
                emoji: 'ðŸ¦',
                colors: ['#FFD700', '#87CEEB', '#98FB98', '#FF6347', '#DDA0DD'],
                sounds: ['Tweet!', 'Chirp!', 'Whistle!'],
                happySounds: ['Happy song!', 'Joyful chirp!', 'Cheerful tweet!'],
                sadSounds: ['Quiet chirp...', 'Soft tweet...']
            },
            hamster: {
                name: 'Hammy',
                emoji: 'ðŸ¹',
                colors: ['#D4A574', '#F5DEB3', '#FFFFFF', '#DEB887', '#FFE4C4'],
                sounds: ['Squeak!', 'Nibble nibble!', 'Scurry!'],
                happySounds: ['Happy squeak!', 'Wheel spinning!', 'Excited nibble!'],
                sadSounds: ['Soft squeak...', 'Quiet nibble...']
            },
            turtle: {
                name: 'Shelly',
                emoji: 'ðŸ¢',
                colors: ['#228B22', '#556B2F', '#6B8E23', '#8FBC8F', '#2E8B57'],
                sounds: ['*slow blink*', '*head bob*', '*shell tap*'],
                happySounds: ['Happy waddle!', 'Excited stretch!', 'Shell shimmy!'],
                sadSounds: ['Hiding in shell...', 'Slow retreat...']
            }
        };

        const TREAT_TYPES = [
            { name: 'Cookie', emoji: 'ðŸª' },
            { name: 'Cupcake', emoji: 'ðŸ§' },
            { name: 'Ice Cream', emoji: 'ðŸ¦' },
            { name: 'Candy', emoji: 'ðŸ¬' },
            { name: 'Donut', emoji: 'ðŸ©' },
            { name: 'Honey', emoji: 'ðŸ¯' }
        ];

        const FEEDBACK_MESSAGES = {
            feed: ['Yummy!', 'Delicious!', 'So tasty!', 'Nom nom!', 'Thank you!'],
            wash: ['So clean!', 'Sparkly!', 'Fresh!', 'Squeaky clean!', 'Shiny!'],
            play: ['So fun!', 'Wheee!', 'Again!', 'Yay!', 'Love it!'],
            sleep: ['So cozy!', 'Sweet dreams!', 'Zzz...', 'Night night!', 'Sleepy time!'],
            medicine: ['All better!', 'Feeling great!', 'So much better!', 'Healthy!', 'Happy again!'],
            groom: ['So fluffy!', 'Looking good!', 'Nice and tidy!', 'Beautiful!', 'Well groomed!'],
            exercise: ['Great run!', 'I fetched it!', 'So much fun!', 'Let\'s go again!', 'What a workout!'],
            treat: ['Yummy treat!', 'So special!', 'Best snack ever!', 'More please!', 'What a delight!'],
            cuddle: ['So cozy!', 'Loves cuddles!', 'Purr purr!', 'Snuggle time!', 'More pets please!']
        };

        const MOOD_MESSAGES = {
            happy: ['is super happy!', 'is feeling great!', 'is full of joy!', 'loves you!'],
            neutral: ['is doing okay.', 'is content.', 'is relaxed.'],
            sad: ['needs some love.', 'misses you.', 'wants attention.']
        };

        // ==================== GAME STATE ====================

        let gameState = {
            phase: 'egg', // 'egg', 'hatching', 'pet'
            pet: null,
            eggTaps: 0,
            lastUpdate: Date.now(),
            timeOfDay: 'day' // 'day', 'sunset', 'night', 'sunrise'
        };

        // ==================== UTILITY FUNCTIONS ====================

        function randomFromArray(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function announce(message, assertive = false) {
            const announcer = document.getElementById(assertive ? 'live-announcer-assertive' : 'live-announcer');
            announcer.textContent = '';
            setTimeout(() => {
                announcer.textContent = message;
            }, 100);
        }

        // ==================== SAVE/LOAD ====================

        function saveGame() {
            try {
                gameState.lastUpdate = Date.now();
                localStorage.setItem('petCareBuddy', JSON.stringify(gameState));
            } catch (e) {
                console.log('Could not save game:', e);
            }
        }

        function loadGame() {
            try {
                const saved = localStorage.getItem('petCareBuddy');
                if (saved) {
                    const parsed = JSON.parse(saved);

                    // Validate saved data structure
                    if (!parsed || typeof parsed !== 'object') {
                        return null;
                    }

                    // Handle stuck 'hatching' phase - reset to egg
                    if (parsed.phase === 'hatching') {
                        parsed.phase = 'egg';
                        parsed.eggTaps = 0;
                    }

                    // Validate pet data if in pet phase
                    if (parsed.phase === 'pet') {
                        if (!parsed.pet ||
                            typeof parsed.pet.hunger !== 'number' ||
                            typeof parsed.pet.cleanliness !== 'number' ||
                            typeof parsed.pet.happiness !== 'number' ||
                            !parsed.pet.type ||
                            !PET_TYPES[parsed.pet.type]) {
                            // Corrupted pet data, start fresh
                            return null;
                        }
                        // Add energy stat if missing (for existing saves)
                        if (typeof parsed.pet.energy !== 'number') {
                            parsed.pet.energy = 70;
                        }
                    }

                    // Update time of day
                    parsed.timeOfDay = getTimeOfDay();

                    // Apply time-based decay for needs
                    if (parsed.pet && parsed.lastUpdate) {
                        const timePassed = Date.now() - parsed.lastUpdate;
                        const minutesPassed = timePassed / 60000;
                        // Decrease needs by 1 point per 2 minutes (slower decay for young children)
                        const decay = Math.floor(minutesPassed / 2);
                        if (decay > 0) {
                            parsed.pet.hunger = clamp(parsed.pet.hunger - decay, 0, 100);
                            parsed.pet.cleanliness = clamp(parsed.pet.cleanliness - decay, 0, 100);
                            parsed.pet.happiness = clamp(parsed.pet.happiness - decay, 0, 100);
                            parsed.pet.energy = clamp(parsed.pet.energy - decay, 0, 100);
                        }
                    }
                    return parsed;
                }
            } catch (e) {
                console.log('Could not load game:', e);
                // Clear corrupted data
                try {
                    localStorage.removeItem('petCareBuddy');
                } catch (clearError) {
                    // Ignore clear errors
                }
            }
            return null;
        }

        // ==================== PET CREATION ====================

        function createPet() {
            const types = Object.keys(PET_TYPES);
            const type = randomFromArray(types);
            const petData = PET_TYPES[type];
            const color = randomFromArray(petData.colors);

            return {
                type: type,
                name: petData.name,
                color: color,
                hunger: 70,
                cleanliness: 70,
                happiness: 70,
                energy: 70
            };
        }

        function getMood(pet) {
            const average = (pet.hunger + pet.cleanliness + pet.happiness + pet.energy) / 4;
            if (average >= 60) return 'happy';
            if (average >= 30) return 'neutral';
            return 'sad';
        }

        // Get time of day based on real time
        function getTimeOfDay() {
            const hour = new Date().getHours();
            if (hour >= 6 && hour < 8) return 'sunrise';
            if (hour >= 8 && hour < 18) return 'day';
            if (hour >= 18 && hour < 20) return 'sunset';
            return 'night';
        }

        // Get time icon based on time of day
        function getTimeIcon(timeOfDay) {
            switch (timeOfDay) {
                case 'sunrise': return 'ðŸŒ…';
                case 'day': return 'â˜€ï¸';
                case 'sunset': return 'ðŸŒ‡';
                case 'night': return 'ðŸŒ™';
                default: return 'â˜€ï¸';
            }
        }

        // Generate stars for nighttime
        function generateStarsHTML() {
            let stars = '';
            for (let i = 0; i < 15; i++) {
                const left = Math.random() * 90 + 5;
                const top = Math.random() * 60 + 5;
                const delay = Math.random() * 2;
                const size = Math.random() * 3 + 2;
                stars += `<div class="star" style="left: ${left}%; top: ${top}%; width: ${size}px; height: ${size}px; animation-delay: ${delay}s;"></div>`;
            }
            return stars;
        }

        // ==================== SVG GENERATION ====================

        function generateEggSVG(crackLevel) {
            const cracks = [];
            if (crackLevel >= 1) {
                cracks.push('<path class="egg-crack" style="opacity:1" d="M55 40 L60 55 L50 50 Z" fill="#8B7355" stroke="#5D4037" stroke-width="1"/>');
            }
            if (crackLevel >= 2) {
                cracks.push('<path class="egg-crack" style="opacity:1" d="M65 60 L75 75 L60 70 Z" fill="#8B7355" stroke="#5D4037" stroke-width="1"/>');
            }
            if (crackLevel >= 3) {
                cracks.push('<path class="egg-crack" style="opacity:1" d="M45 70 L40 85 L55 80 Z" fill="#8B7355" stroke="#5D4037" stroke-width="1"/>');
            }

            return `
                <svg class="egg-svg" viewBox="0 0 100 130" role="img" aria-label="A colorful egg waiting to hatch. Tap to help it hatch!">
                    <defs>
                        <linearGradient id="eggGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFE4B5"/>
                            <stop offset="50%" style="stop-color:#FFDAB9"/>
                            <stop offset="100%" style="stop-color:#FFE4B5"/>
                        </linearGradient>
                        <linearGradient id="eggShine" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:rgba(255,255,255,0.6)"/>
                            <stop offset="100%" style="stop-color:rgba(255,255,255,0)"/>
                        </linearGradient>
                    </defs>
                    <!-- Egg body -->
                    <ellipse cx="50" cy="70" rx="40" ry="50" fill="url(#eggGradient)" stroke="#DEB887" stroke-width="3"/>
                    <!-- Decorative spots -->
                    <circle cx="35" cy="50" r="8" fill="#FFB6C1" opacity="0.7"/>
                    <circle cx="65" cy="45" r="6" fill="#87CEEB" opacity="0.7"/>
                    <circle cx="55" cy="80" r="7" fill="#98FB98" opacity="0.7"/>
                    <circle cx="30" cy="75" r="5" fill="#DDA0DD" opacity="0.7"/>
                    <circle cx="70" cy="70" r="6" fill="#FFD700" opacity="0.7"/>
                    <!-- Shine -->
                    <ellipse cx="35" cy="45" rx="15" ry="20" fill="url(#eggShine)"/>
                    <!-- Cracks -->
                    ${cracks.join('')}
                </svg>
            `;
        }

        function generatePetSVG(pet, mood) {
            const type = pet.type;
            const color = pet.color;

            // Eye style based on mood
            let eyeStyle = '';
            let mouthPath = '';

            switch (mood) {
                case 'happy':
                    eyeStyle = 'arc'; // Happy curved eyes
                    mouthPath = 'M35 75 Q50 90 65 75'; // Big smile
                    break;
                case 'neutral':
                    eyeStyle = 'normal';
                    mouthPath = 'M40 78 L60 78'; // Straight line
                    break;
                case 'sad':
                    eyeStyle = 'sad';
                    mouthPath = 'M35 82 Q50 72 65 82'; // Frown
                    break;
            }

            const petSVGs = {
                dog: generateDogSVG(color, eyeStyle, mouthPath, mood),
                cat: generateCatSVG(color, eyeStyle, mouthPath, mood),
                bunny: generateBunnySVG(color, eyeStyle, mouthPath, mood),
                bird: generateBirdSVG(color, eyeStyle, mouthPath, mood),
                hamster: generateHamsterSVG(color, eyeStyle, mouthPath, mood),
                turtle: generateTurtleSVG(color, eyeStyle, mouthPath, mood)
            };

            return petSVGs[type] || petSVGs.dog;
        }

        function generateEyes(eyeStyle, leftX, rightX, y) {
            switch (eyeStyle) {
                case 'arc':
                    return `
                        <path d="M${leftX - 5} ${y} Q${leftX} ${y - 8} ${leftX + 5} ${y}" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
                        <path d="M${rightX - 5} ${y} Q${rightX} ${y - 8} ${rightX + 5} ${y}" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
                    `;
                case 'sad':
                    return `
                        <circle cx="${leftX}" cy="${y}" r="5" fill="#333"/>
                        <circle cx="${rightX}" cy="${y}" r="5" fill="#333"/>
                        <circle cx="${leftX + 1}" cy="${y - 1}" r="1.5" fill="white"/>
                        <circle cx="${rightX + 1}" cy="${y - 1}" r="1.5" fill="white"/>
                        <path d="M${leftX - 6} ${y - 8} L${leftX + 4} ${y - 5}" stroke="#333" stroke-width="2" stroke-linecap="round"/>
                        <path d="M${rightX + 6} ${y - 8} L${rightX - 4} ${y - 5}" stroke="#333" stroke-width="2" stroke-linecap="round"/>
                    `;
                default:
                    return `
                        <circle cx="${leftX}" cy="${y}" r="6" fill="#333"/>
                        <circle cx="${rightX}" cy="${y}" r="6" fill="#333"/>
                        <circle cx="${leftX + 2}" cy="${y - 2}" r="2" fill="white"/>
                        <circle cx="${rightX + 2}" cy="${y - 2}" r="2" fill="white"/>
                    `;
            }
        }

        function generateDogSVG(color, eyeStyle, mouthPath, mood) {
            return `
                <svg class="pet-svg" viewBox="0 0 100 100" role="img" aria-label="${mood === 'happy' ? 'A happy puppy wagging its tail' : mood === 'sad' ? 'A sad puppy who needs love' : 'A calm puppy'}">
                    <!-- Body -->
                    <ellipse cx="50" cy="70" rx="30" ry="25" fill="${color}"/>
                    <!-- Head -->
                    <circle cx="50" cy="40" r="25" fill="${color}"/>
                    <!-- Ears -->
                    <ellipse cx="25" cy="30" rx="10" ry="18" fill="${color}" transform="rotate(-20 25 30)"/>
                    <ellipse cx="75" cy="30" rx="10" ry="18" fill="${color}" transform="rotate(20 75 30)"/>
                    <!-- Inner ears -->
                    <ellipse cx="25" cy="32" rx="5" ry="10" fill="#FFB6C1" transform="rotate(-20 25 32)"/>
                    <ellipse cx="75" cy="32" rx="5" ry="10" fill="#FFB6C1" transform="rotate(20 75 32)"/>
                    <!-- Snout -->
                    <ellipse cx="50" cy="50" rx="12" ry="10" fill="#F5DEB3"/>
                    <!-- Nose -->
                    <ellipse cx="50" cy="48" rx="5" ry="4" fill="#333"/>
                    <!-- Eyes -->
                    ${generateEyes(eyeStyle, 38, 62, 38)}
                    <!-- Mouth -->
                    <path d="${mouthPath}" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <!-- Tail -->
                    <path d="M80 70 Q95 ${mood === 'happy' ? '50' : '65'} 85 ${mood === 'happy' ? '45' : '60'}" stroke="${color}" stroke-width="8" fill="none" stroke-linecap="round"/>
                    <!-- Cheeks -->
                    ${mood === 'happy' ? '<circle cx="30" cy="48" r="5" fill="#FFB6C1" opacity="0.5"/><circle cx="70" cy="48" r="5" fill="#FFB6C1" opacity="0.5"/>' : ''}
                </svg>
            `;
        }

        function generateCatSVG(color, eyeStyle, mouthPath, mood) {
            return `
                <svg class="pet-svg" viewBox="0 0 100 100" role="img" aria-label="${mood === 'happy' ? 'A happy kitty purring' : mood === 'sad' ? 'A sad kitty who needs love' : 'A calm kitty'}">
                    <!-- Body -->
                    <ellipse cx="50" cy="72" rx="28" ry="23" fill="${color}"/>
                    <!-- Head -->
                    <circle cx="50" cy="40" r="24" fill="${color}"/>
                    <!-- Ears (triangles) -->
                    <polygon points="25,35 20,10 40,25" fill="${color}"/>
                    <polygon points="75,35 80,10 60,25" fill="${color}"/>
                    <!-- Inner ears -->
                    <polygon points="27,32 24,18 36,27" fill="#FFB6C1"/>
                    <polygon points="73,32 76,18 64,27" fill="#FFB6C1"/>
                    <!-- Eyes -->
                    ${eyeStyle === 'arc' ?
                    `<path d="M33 38 Q38 30 43 38" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>
                     <path d="M57 38 Q62 30 67 38" stroke="#333" stroke-width="3" fill="none" stroke-linecap="round"/>` :
                    eyeStyle === 'sad' ?
                    `<ellipse cx="38" cy="38" rx="5" ry="7" fill="#90EE90"/>
                     <ellipse cx="62" cy="38" rx="5" ry="7" fill="#90EE90"/>
                     <ellipse cx="38" cy="39" rx="2" ry="5" fill="#333"/>
                     <ellipse cx="62" cy="39" rx="2" ry="5" fill="#333"/>
                     <path d="M32 32 L42 35" stroke="#333" stroke-width="2" stroke-linecap="round"/>
                     <path d="M68 32 L58 35" stroke="#333" stroke-width="2" stroke-linecap="round"/>` :
                    `<ellipse cx="38" cy="38" rx="5" ry="7" fill="#90EE90"/>
                     <ellipse cx="62" cy="38" rx="5" ry="7" fill="#90EE90"/>
                     <ellipse cx="38" cy="39" rx="2" ry="5" fill="#333"/>
                     <ellipse cx="62" cy="39" rx="2" ry="5" fill="#333"/>`}
                    <!-- Nose -->
                    <polygon points="50,48 46,44 54,44" fill="#FFB6C1"/>
                    <!-- Mouth -->
                    <path d="${mouthPath}" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <!-- Whiskers -->
                    <line x1="20" y1="48" x2="35" y2="50" stroke="#333" stroke-width="1"/>
                    <line x1="20" y1="52" x2="35" y2="52" stroke="#333" stroke-width="1"/>
                    <line x1="65" y1="50" x2="80" y2="48" stroke="#333" stroke-width="1"/>
                    <line x1="65" y1="52" x2="80" y2="52" stroke="#333" stroke-width="1"/>
                    <!-- Tail -->
                    <path d="M78 72 Q100 60 95 ${mood === 'happy' ? '40' : '55'}" stroke="${color}" stroke-width="8" fill="none" stroke-linecap="round"/>
                    <!-- Cheeks -->
                    ${mood === 'happy' ? '<circle cx="28" cy="48" r="5" fill="#FFB6C1" opacity="0.5"/><circle cx="72" cy="48" r="5" fill="#FFB6C1" opacity="0.5"/>' : ''}
                </svg>
            `;
        }

        function generateBunnySVG(color, eyeStyle, mouthPath, mood) {
            // Bunny-specific mouth paths (adjusted for bunny face position)
            let bunnyMouth = '';
            if (mood === 'happy') {
                bunnyMouth = '<path d="M46 56 L50 62 L54 56" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>';
            } else if (mood === 'sad') {
                bunnyMouth = '<path d="M46 60 Q50 55 54 60" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>';
            } else {
                bunnyMouth = '<path d="M46 58 L54 58" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>';
            }

            return `
                <svg class="pet-svg" viewBox="0 0 100 100" role="img" aria-label="${mood === 'happy' ? 'A happy bunny hopping with joy' : mood === 'sad' ? 'A sad bunny who needs love' : 'A calm bunny'}">
                    <!-- Body -->
                    <ellipse cx="50" cy="75" rx="25" ry="20" fill="${color}"/>
                    <!-- Head -->
                    <circle cx="50" cy="45" r="22" fill="${color}"/>
                    <!-- Ears (long) -->
                    <ellipse cx="35" cy="15" rx="8" ry="25" fill="${color}"/>
                    <ellipse cx="65" cy="15" rx="8" ry="25" fill="${color}"/>
                    <!-- Inner ears -->
                    <ellipse cx="35" cy="15" rx="4" ry="18" fill="#FFB6C1"/>
                    <ellipse cx="65" cy="15" rx="4" ry="18" fill="#FFB6C1"/>
                    <!-- Eyes -->
                    ${generateEyes(eyeStyle, 40, 60, 42)}
                    <!-- Nose -->
                    <ellipse cx="50" cy="52" rx="4" ry="3" fill="#FFB6C1"/>
                    <!-- Mouth -->
                    ${bunnyMouth}
                    <!-- Cheeks -->
                    <circle cx="32" cy="52" r="6" fill="#FFB6C1" opacity="${mood === 'happy' ? '0.7' : '0.5'}"/>
                    <circle cx="68" cy="52" r="6" fill="#FFB6C1" opacity="${mood === 'happy' ? '0.7' : '0.5'}"/>
                    <!-- Feet -->
                    <ellipse cx="35" cy="92" rx="10" ry="6" fill="${color}"/>
                    <ellipse cx="65" cy="92" rx="10" ry="6" fill="${color}"/>
                    <!-- Tail (fluffy ball) -->
                    <circle cx="75" cy="80" r="8" fill="white"/>
                </svg>
            `;
        }

        function generateBirdSVG(color, eyeStyle, mouthPath, mood) {
            return `
                <svg class="pet-svg" viewBox="0 0 100 100" role="img" aria-label="${mood === 'happy' ? 'A happy bird singing' : mood === 'sad' ? 'A sad bird who needs love' : 'A calm bird'}">
                    <!-- Body -->
                    <ellipse cx="50" cy="65" rx="25" ry="28" fill="${color}"/>
                    <!-- Head -->
                    <circle cx="50" cy="32" r="20" fill="${color}"/>
                    <!-- Wing -->
                    <ellipse cx="30" cy="65" rx="15" ry="20" fill="${color}" opacity="0.8"/>
                    <ellipse cx="70" cy="65" rx="15" ry="20" fill="${color}" opacity="0.8"/>
                    <!-- Belly -->
                    <ellipse cx="50" cy="70" rx="15" ry="18" fill="#F5F5DC"/>
                    <!-- Eyes -->
                    ${generateEyes(eyeStyle, 42, 58, 30)}
                    <!-- Beak -->
                    <polygon points="50,38 42,45 50,48 58,45" fill="#FFA500"/>
                    <!-- Tuft -->
                    <ellipse cx="50" cy="14" rx="5" ry="8" fill="${color}"/>
                    <ellipse cx="45" cy="16" rx="4" ry="6" fill="${color}"/>
                    <ellipse cx="55" cy="16" rx="4" ry="6" fill="${color}"/>
                    <!-- Feet -->
                    <line x1="42" y1="90" x2="42" y2="98" stroke="#FFA500" stroke-width="3"/>
                    <line x1="50" y1="92" x2="50" y2="98" stroke="#FFA500" stroke-width="3"/>
                    <line x1="58" y1="90" x2="58" y2="98" stroke="#FFA500" stroke-width="3"/>
                    <!-- Cheeks -->
                    ${mood === 'happy' ? '<circle cx="35" cy="38" r="4" fill="#FFB6C1" opacity="0.6"/><circle cx="65" cy="38" r="4" fill="#FFB6C1" opacity="0.6"/>' : ''}
                </svg>
            `;
        }

        function generateHamsterSVG(color, eyeStyle, mouthPath, mood) {
            return `
                <svg class="pet-svg" viewBox="0 0 100 100" role="img" aria-label="${mood === 'happy' ? 'A happy hamster running on its wheel' : mood === 'sad' ? 'A sad hamster who needs love' : 'A calm hamster'}">
                    <!-- Body -->
                    <ellipse cx="50" cy="70" rx="30" ry="25" fill="${color}"/>
                    <!-- Head -->
                    <circle cx="50" cy="40" r="28" fill="${color}"/>
                    <!-- Ears -->
                    <circle cx="25" cy="22" r="10" fill="${color}"/>
                    <circle cx="75" cy="22" r="10" fill="${color}"/>
                    <!-- Inner ears -->
                    <circle cx="25" cy="22" r="5" fill="#FFB6C1"/>
                    <circle cx="75" cy="22" r="5" fill="#FFB6C1"/>
                    <!-- Cheeks (puffy) -->
                    <circle cx="28" cy="48" r="12" fill="#FFE4C4"/>
                    <circle cx="72" cy="48" r="12" fill="#FFE4C4"/>
                    <!-- Eyes -->
                    ${generateEyes(eyeStyle, 40, 60, 38)}
                    <!-- Nose -->
                    <circle cx="50" cy="50" r="4" fill="#333"/>
                    <!-- Mouth -->
                    <path d="${mouthPath}" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <!-- Whiskers -->
                    <line x1="15" y1="48" x2="28" y2="50" stroke="#333" stroke-width="1"/>
                    <line x1="15" y1="52" x2="28" y2="52" stroke="#333" stroke-width="1"/>
                    <line x1="72" y1="50" x2="85" y2="48" stroke="#333" stroke-width="1"/>
                    <line x1="72" y1="52" x2="85" y2="52" stroke="#333" stroke-width="1"/>
                    <!-- Paws -->
                    <ellipse cx="30" cy="88" rx="8" ry="5" fill="${color}"/>
                    <ellipse cx="70" cy="88" rx="8" ry="5" fill="${color}"/>
                    <!-- Belly -->
                    <ellipse cx="50" cy="72" rx="18" ry="15" fill="#F5F5DC"/>
                </svg>
            `;
        }

        function generateTurtleSVG(color, eyeStyle, mouthPath, mood) {
            return `
                <svg class="pet-svg" viewBox="0 0 100 100" role="img" aria-label="${mood === 'happy' ? 'A happy turtle basking in the sun' : mood === 'sad' ? 'A sad turtle hiding in its shell' : 'A calm turtle'}">
                    <!-- Shell -->
                    <ellipse cx="50" cy="60" rx="38" ry="30" fill="${color}"/>
                    <!-- Shell pattern -->
                    <ellipse cx="50" cy="55" rx="25" ry="18" fill="none" stroke="#2E7D32" stroke-width="2"/>
                    <path d="M50 37 L50 73" stroke="#2E7D32" stroke-width="2"/>
                    <path d="M25 55 L75 55" stroke="#2E7D32" stroke-width="2"/>
                    <path d="M30 42 L70 68" stroke="#2E7D32" stroke-width="2"/>
                    <path d="M30 68 L70 42" stroke="#2E7D32" stroke-width="2"/>
                    <!-- Shell rim -->
                    <ellipse cx="50" cy="60" rx="38" ry="30" fill="none" stroke="#1B5E20" stroke-width="3"/>
                    <!-- Head -->
                    <ellipse cx="50" cy="28" rx="15" ry="12" fill="#8FBC8F"/>
                    <!-- Eyes -->
                    ${generateEyes(eyeStyle, 44, 56, 26)}
                    <!-- Mouth -->
                    <path d="M45 33 Q50 ${mood === 'happy' ? '38' : '35'} 55 33" stroke="#333" stroke-width="2" fill="none" stroke-linecap="round"/>
                    <!-- Legs -->
                    <ellipse cx="20" cy="55" rx="10" ry="8" fill="#8FBC8F"/>
                    <ellipse cx="80" cy="55" rx="10" ry="8" fill="#8FBC8F"/>
                    <ellipse cx="25" cy="80" rx="8" ry="10" fill="#8FBC8F"/>
                    <ellipse cx="75" cy="80" rx="8" ry="10" fill="#8FBC8F"/>
                    <!-- Tail -->
                    <ellipse cx="50" cy="92" rx="6" ry="4" fill="#8FBC8F"/>
                    <!-- Cheeks -->
                    ${mood === 'happy' ? '<circle cx="38" cy="30" r="3" fill="#FFB6C1" opacity="0.5"/><circle cx="62" cy="30" r="3" fill="#FFB6C1" opacity="0.5"/>' : ''}
                </svg>
            `;
        }

        // ==================== RENDER FUNCTIONS ====================

        // Track if egg handlers are attached to prevent duplicates
        let eggHandlersAttached = false;

        function renderEggPhase(maintainFocus = false) {
            const content = document.getElementById('game-content');
            const crackLevel = Math.min(gameState.eggTaps, 3);

            content.innerHTML = `
                <div class="pet-area" role="region" aria-label="Egg hatching area">
                    <div class="sparkles" id="sparkles"></div>
                    <button class="egg-container" id="egg-button"
                            aria-label="Tap the egg to help it hatch! Tapped ${gameState.eggTaps} of 5 times. ${5 - gameState.eggTaps} more taps needed."
                            aria-describedby="tap-hint">
                        ${generateEggSVG(crackLevel)}
                    </button>
                    <p class="hatch-message" aria-live="polite">A mystery pet is inside!</p>
                    <p class="tap-hint" id="tap-hint">Tap the egg to hatch it!</p>
                </div>
            `;

            const eggButton = document.getElementById('egg-button');

            // Use named function to allow proper removal if needed
            function onEggClick(e) {
                e.preventDefault();
                handleEggTap();
            }

            function onEggKeydown(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleEggTap();
                }
            }

            eggButton.addEventListener('click', onEggClick);
            eggButton.addEventListener('keydown', onEggKeydown);

            // Maintain focus for keyboard users
            if (maintainFocus) {
                eggButton.focus();
            }
        }

        // Prevent rapid tapping issues
        let eggTapCooldown = false;

        function handleEggTap() {
            if (eggTapCooldown) return;

            eggTapCooldown = true;
            setTimeout(() => { eggTapCooldown = false; }, 200);

            gameState.eggTaps++;
            const eggButton = document.getElementById('egg-button');
            const sparkles = document.getElementById('sparkles');

            // Add shake animation
            eggButton.classList.add('egg-shake');
            setTimeout(() => eggButton.classList.remove('egg-shake'), 300);

            // Add sparkles
            createSparkles(sparkles, 5);

            // Announce progress
            const remaining = 5 - gameState.eggTaps;
            if (remaining > 0) {
                announce(`Tap ${gameState.eggTaps} of 5. ${remaining} more to hatch!`);
            }

            if (gameState.eggTaps >= 5) {
                // Hatch the egg!
                gameState.phase = 'hatching';
                announce('The egg is hatching! Here comes your pet!', true);
                setTimeout(hatchPet, 1000);
            } else {
                // Update egg display with more cracks, maintain focus for keyboard users
                renderEggPhase(true);
            }

            saveGame();
        }

        function hatchPet() {
            // Reset egg tap cooldown
            eggTapCooldown = false;

            gameState.pet = createPet();
            gameState.phase = 'pet';
            saveGame();

            const petData = PET_TYPES[gameState.pet.type];
            announce(`Congratulations! You hatched a ${petData.name}! ${petData.emoji}`, true);

            renderPetPhase();
        }

        function renderPetPhase() {
            const content = document.getElementById('game-content');
            const pet = gameState.pet;
            const petData = PET_TYPES[pet.type];
            const mood = getMood(pet);
            const moodMessage = randomFromArray(MOOD_MESSAGES[mood]);

            // Update time of day
            gameState.timeOfDay = getTimeOfDay();
            const timeOfDay = gameState.timeOfDay;
            const timeIcon = getTimeIcon(timeOfDay);
            const timeClass = timeOfDay === 'day' ? 'daytime' : timeOfDay === 'night' ? 'nighttime' : timeOfDay;

            // Generate celestial elements
            let celestialHTML = '';
            if (timeOfDay === 'night') {
                celestialHTML = `<div class="stars-overlay">${generateStarsHTML()}</div><div class="moon"></div>`;
            } else if (timeOfDay === 'day') {
                celestialHTML = `<div class="sun"></div>`;
            }

            content.innerHTML = `
                <div class="pet-area ${timeClass}" role="region" aria-label="Your pet ${petData.name}">
                    ${celestialHTML}
                    <div class="time-indicator" aria-label="Time: ${timeOfDay}">${timeIcon}</div>
                    <div class="sparkles" id="sparkles"></div>
                    <div class="pet-container" id="pet-container">
                        ${generatePetSVG(pet, mood)}
                    </div>
                    <p class="pet-name">${petData.emoji} ${petData.name}</p>
                    <p class="pet-mood" id="pet-mood" aria-live="polite">Your pet ${moodMessage}</p>
                </div>

                <section class="needs-section" aria-label="Pet needs">
                    <div class="needs-row">
                        <div class="need-bubble ${pet.hunger <= 25 ? 'low' : ''}" id="hunger-bubble"
                             role="progressbar" aria-label="Hunger level" aria-valuenow="${pet.hunger}" aria-valuemin="0" aria-valuemax="100"
                             style="--progress: ${pet.hunger}; --ring-color: var(--color-hunger);">
                            <div class="need-bubble-ring"></div>
                            <span class="need-bubble-icon" aria-hidden="true">ðŸŽ</span>
                            <span class="need-bubble-value" id="hunger-value">${pet.hunger}%</span>
                        </div>
                        <div class="need-bubble ${pet.cleanliness <= 25 ? 'low' : ''}" id="clean-bubble"
                             role="progressbar" aria-label="Cleanliness level" aria-valuenow="${pet.cleanliness}" aria-valuemin="0" aria-valuemax="100"
                             style="--progress: ${pet.cleanliness}; --ring-color: var(--color-clean);">
                            <div class="need-bubble-ring"></div>
                            <span class="need-bubble-icon" aria-hidden="true">ðŸ›</span>
                            <span class="need-bubble-value" id="clean-value">${pet.cleanliness}%</span>
                        </div>
                        <div class="need-bubble ${pet.happiness <= 25 ? 'low' : ''}" id="happy-bubble"
                             role="progressbar" aria-label="Happiness level" aria-valuenow="${pet.happiness}" aria-valuemin="0" aria-valuemax="100"
                             style="--progress: ${pet.happiness}; --ring-color: var(--color-happy-bar);">
                            <div class="need-bubble-ring"></div>
                            <span class="need-bubble-icon" aria-hidden="true">ðŸ’–</span>
                            <span class="need-bubble-value" id="happy-value">${pet.happiness}%</span>
                        </div>
                        <div class="need-bubble ${pet.energy <= 25 ? 'low' : ''}" id="energy-bubble"
                             role="progressbar" aria-label="Energy level" aria-valuenow="${pet.energy}" aria-valuemin="0" aria-valuemax="100"
                             style="--progress: ${pet.energy}; --ring-color: var(--color-energy);">
                            <div class="need-bubble-ring"></div>
                            <span class="need-bubble-icon" aria-hidden="true">ðŸ˜´</span>
                            <span class="need-bubble-value" id="energy-value">${pet.energy}%</span>
                        </div>
                    </div>
                </section>

                <div class="feedback-area">
                    <p class="feedback-message" id="feedback" aria-live="polite"></p>
                </div>

                <section class="actions-section" aria-label="Care actions">
                    <div class="action-scroll" role="group" aria-label="Pet care buttons">
                        <button class="action-btn feed" id="feed-btn" aria-label="Feed your pet. Current hunger: ${pet.hunger}%">
                            <span class="btn-icon" aria-hidden="true">ðŸŽ</span>
                            <span>Feed</span>
                        </button>
                        <button class="action-btn wash" id="wash-btn" aria-label="Wash your pet. Current cleanliness: ${pet.cleanliness}%">
                            <span class="btn-icon" aria-hidden="true">ðŸ›</span>
                            <span>Wash</span>
                        </button>
                        <button class="action-btn play" id="play-btn" aria-label="Play with your pet. Current happiness: ${pet.happiness}%">
                            <span class="btn-icon" aria-hidden="true">âš½</span>
                            <span>Play</span>
                        </button>
                        <button class="action-btn sleep" id="sleep-btn" aria-label="Put your pet to sleep. Current energy: ${pet.energy}%">
                            <span class="btn-icon" aria-hidden="true">ðŸ›ï¸</span>
                            <span>Sleep</span>
                        </button>
                        <button class="action-btn pet-cuddle" id="pet-btn" aria-label="Pet and cuddle your pet. Current happiness: ${pet.happiness}%">
                            <span class="btn-icon" aria-hidden="true">ðŸ¤—</span>
                            <span>Pet</span>
                        </button>
                        <button class="action-btn medicine" id="medicine-btn" aria-label="Give medicine to help your pet feel better">
                            <span class="btn-icon" aria-hidden="true">ðŸ©¹</span>
                            <span>Medicine</span>
                        </button>
                        <button class="action-btn groom" id="groom-btn" aria-label="Groom your pet - brush fur and trim nails">
                            <span class="btn-icon" aria-hidden="true">âœ‚ï¸</span>
                            <span>Groom</span>
                        </button>
                        <button class="action-btn exercise" id="exercise-btn" aria-label="Exercise your pet - take a walk or play fetch">
                            <span class="btn-icon" aria-hidden="true">ðŸƒ</span>
                            <span>Exercise</span>
                        </button>
                        <button class="action-btn treat" id="treat-btn" aria-label="Give your pet a special treat for bonus happiness">
                            <span class="btn-icon" aria-hidden="true">ðŸª</span>
                            <span>Treat</span>
                        </button>
                    </div>
                </section>

                <button class="new-pet-btn" id="new-pet-btn" aria-label="Start over with a new egg">
                    ðŸ¥š New Pet
                </button>
            `;

            // Add event listeners
            document.getElementById('feed-btn').addEventListener('click', () => careAction('feed'));
            document.getElementById('wash-btn').addEventListener('click', () => careAction('wash'));
            document.getElementById('play-btn').addEventListener('click', () => careAction('play'));
            document.getElementById('sleep-btn').addEventListener('click', () => careAction('sleep'));
            document.getElementById('medicine-btn').addEventListener('click', () => careAction('medicine'));
            document.getElementById('groom-btn').addEventListener('click', () => careAction('groom'));
            document.getElementById('exercise-btn').addEventListener('click', () => careAction('exercise'));
            document.getElementById('treat-btn').addEventListener('click', () => careAction('treat'));
            document.getElementById('pet-btn').addEventListener('click', () => careAction('cuddle'));
            document.getElementById('new-pet-btn').addEventListener('click', startNewPet);

            // Make pet directly pettable by clicking/touching the pet SVG
            const petContainer = document.getElementById('pet-container');
            petContainer.classList.add('pettable');
            petContainer.setAttribute('role', 'button');
            petContainer.setAttribute('tabindex', '0');
            petContainer.setAttribute('aria-label', 'Click or tap your pet to give it cuddles!');
            petContainer.addEventListener('click', () => careAction('cuddle'));
            petContainer.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    careAction('cuddle');
                }
            });

            // Start decay timer
            startDecayTimer();
        }

        // Track button cooldowns
        let actionCooldown = false;

        function careAction(action) {
            // Prevent rapid clicking
            if (actionCooldown) return;

            actionCooldown = true;
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(btn => btn.classList.add('cooldown'));

            setTimeout(() => {
                actionCooldown = false;
                buttons.forEach(btn => btn.classList.remove('cooldown'));
            }, 600);

            const pet = gameState.pet;
            const petData = PET_TYPES[pet.type];
            const petContainer = document.getElementById('pet-container');
            const sparkles = document.getElementById('sparkles');
            let message = '';

            switch (action) {
                case 'feed':
                    pet.hunger = clamp(pet.hunger + 20, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.feed);
                    petContainer.classList.add('bounce');
                    createFoodParticles(sparkles);
                    announce(`Fed your pet! Hunger is now ${pet.hunger}%`);
                    break;
                case 'wash':
                    pet.cleanliness = clamp(pet.cleanliness + 20, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.wash);
                    petContainer.classList.add('sparkle');
                    createBubbles(sparkles);
                    announce(`Washed your pet! Cleanliness is now ${pet.cleanliness}%`);
                    break;
                case 'play':
                    pet.happiness = clamp(pet.happiness + 20, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.play);
                    petContainer.classList.add('wiggle');
                    createHearts(sparkles);
                    announce(`Played with your pet! Happiness is now ${pet.happiness}%`);
                    break;
                case 'sleep':
                    pet.energy = clamp(pet.energy + 25, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.sleep);
                    petContainer.classList.add('sleep-anim');
                    createZzz(sparkles);
                    announce(`Your pet had a nice nap! Energy is now ${pet.energy}%`);
                    break;
                case 'medicine':
                    // Medicine gives a gentle boost to all stats - helps pet feel better
                    pet.hunger = clamp(pet.hunger + 10, 0, 100);
                    pet.cleanliness = clamp(pet.cleanliness + 10, 0, 100);
                    pet.happiness = clamp(pet.happiness + 15, 0, 100);
                    pet.energy = clamp(pet.energy + 10, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.medicine);
                    petContainer.classList.add('heal-anim');
                    createMedicineParticles(sparkles);
                    announce(`You gave your pet medicine! Your pet feels much better now!`);
                    break;
                case 'groom':
                    // Grooming - brush fur/feathers and trim nails
                    pet.cleanliness = clamp(pet.cleanliness + 15, 0, 100);
                    pet.happiness = clamp(pet.happiness + 10, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.groom);
                    petContainer.classList.add('groom-anim');
                    createGroomParticles(sparkles);
                    announce(`Groomed your pet! Looking beautiful and feeling happy!`);
                    break;
                case 'exercise':
                    // Exercise - take walks or play fetch
                    pet.happiness = clamp(pet.happiness + 20, 0, 100);
                    pet.energy = clamp(pet.energy - 10, 0, 100);
                    pet.hunger = clamp(pet.hunger - 5, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.exercise);
                    petContainer.classList.add('exercise-anim');
                    createExerciseParticles(sparkles);
                    announce(`Exercised your pet! Happiness is now ${pet.happiness}% but energy dropped to ${pet.energy}%`);
                    break;
                case 'treat': {
                    // Treats - special snacks that give bonus happiness
                    const treat = randomFromArray(TREAT_TYPES);
                    pet.happiness = clamp(pet.happiness + 25, 0, 100);
                    pet.hunger = clamp(pet.hunger + 10, 0, 100);
                    message = `${treat.emoji} ${randomFromArray(FEEDBACK_MESSAGES.treat)}`;
                    petContainer.classList.add('treat-anim');
                    createTreatParticles(sparkles, treat.emoji);
                    announce(`Gave your pet a ${treat.name}! Happiness is now ${pet.happiness}%`);
                    break;
                }
                case 'cuddle':
                    // Petting/Cuddling - direct affection boosts happiness and energy
                    pet.happiness = clamp(pet.happiness + 15, 0, 100);
                    pet.energy = clamp(pet.energy + 5, 0, 100);
                    message = randomFromArray(FEEDBACK_MESSAGES.cuddle);
                    petContainer.classList.add('cuddle-anim');
                    createCuddleParticles(sparkles);
                    announce(`You pet and cuddled your pet! Happiness is now ${pet.happiness}%`);
                    break;
            }

            // Show feedback
            const feedback = document.getElementById('feedback');
            feedback.textContent = `${petData.emoji} ${message}`;
            feedback.classList.add('show');

            // Update displays
            updateNeedDisplays();
            updatePetMood();

            // Remove animation class
            setTimeout(() => {
                petContainer.classList.remove('bounce', 'wiggle', 'sparkle', 'sleep-anim', 'heal-anim', 'groom-anim', 'exercise-anim', 'treat-anim', 'cuddle-anim');
            }, 800);

            // Hide feedback
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 2000);

            saveGame();
        }

        function updateNeedDisplays() {
            const pet = gameState.pet;

            // Helper to update a bubble indicator
            function updateBubble(id, value) {
                const bubble = document.getElementById(id);
                if (!bubble) return;
                bubble.style.setProperty('--progress', value);
                if (value <= 25) {
                    bubble.classList.add('low');
                } else {
                    bubble.classList.remove('low');
                }
                bubble.setAttribute('aria-valuenow', value);
            }

            // Update circular indicators
            updateBubble('hunger-bubble', pet.hunger);
            updateBubble('clean-bubble', pet.cleanliness);
            updateBubble('happy-bubble', pet.happiness);
            updateBubble('energy-bubble', pet.energy);

            // Update values
            document.getElementById('hunger-value').textContent = `${pet.hunger}%`;
            document.getElementById('clean-value').textContent = `${pet.cleanliness}%`;
            document.getElementById('happy-value').textContent = `${pet.happiness}%`;
            document.getElementById('energy-value').textContent = `${pet.energy}%`;

            // Update button labels with more descriptive text
            const hungerDesc = pet.hunger <= 25 ? 'very low' : pet.hunger <= 50 ? 'low' : pet.hunger <= 75 ? 'good' : 'full';
            const cleanDesc = pet.cleanliness <= 25 ? 'very dirty' : pet.cleanliness <= 50 ? 'needs washing' : pet.cleanliness <= 75 ? 'clean' : 'sparkly clean';
            const happyDesc = pet.happiness <= 25 ? 'sad' : pet.happiness <= 50 ? 'bored' : pet.happiness <= 75 ? 'happy' : 'very happy';
            const energyDesc = pet.energy <= 25 ? 'exhausted' : pet.energy <= 50 ? 'tired' : pet.energy <= 75 ? 'rested' : 'full of energy';

            document.getElementById('feed-btn').setAttribute('aria-label', `Feed your pet. Hunger level: ${pet.hunger}%, ${hungerDesc}`);
            document.getElementById('wash-btn').setAttribute('aria-label', `Wash your pet. Cleanliness: ${pet.cleanliness}%, ${cleanDesc}`);
            document.getElementById('play-btn').setAttribute('aria-label', `Play with your pet. Happiness: ${pet.happiness}%, ${happyDesc}`);
            document.getElementById('sleep-btn').setAttribute('aria-label', `Put your pet to sleep. Energy: ${pet.energy}%, ${energyDesc}`);

            // Update medicine button with overall wellness description
            const avgWellness = Math.round((pet.hunger + pet.cleanliness + pet.happiness + pet.energy) / 4);
            const wellnessDesc = avgWellness <= 25 ? 'not feeling well' : avgWellness <= 50 ? 'could feel better' : avgWellness <= 75 ? 'feeling good' : 'feeling great';
            document.getElementById('medicine-btn').setAttribute('aria-label', `Give medicine to help your pet feel better. Pet is ${wellnessDesc}`);

            // Update groom button - grooming helps cleanliness and happiness
            const groomDesc = pet.cleanliness <= 50 ? 'could use some grooming' : 'looking good';
            document.getElementById('groom-btn').setAttribute('aria-label', `Groom your pet - brush fur and trim nails. Cleanliness: ${pet.cleanliness}%, ${groomDesc}`);

            // Update exercise button - exercise boosts happiness but uses energy
            const exerciseDesc = pet.energy <= 25 ? 'too tired to exercise' : pet.happiness <= 50 ? 'needs some exercise' : 'enjoying activities';
            document.getElementById('exercise-btn').setAttribute('aria-label', `Exercise your pet - take a walk or play fetch. Happiness: ${pet.happiness}%, ${exerciseDesc}`);

            // Update pet/cuddle button - petting gives affection
            const cuddleDesc = pet.happiness <= 50 ? 'wants cuddles' : 'loves your attention';
            document.getElementById('pet-btn').setAttribute('aria-label', `Pet and cuddle your pet. Happiness: ${pet.happiness}%, ${cuddleDesc}`);
        }

        function updatePetMood() {
            const pet = gameState.pet;
            const petData = PET_TYPES[pet.type];
            const mood = getMood(pet);
            const moodMessage = randomFromArray(MOOD_MESSAGES[mood]);

            // Update pet SVG
            const petContainer = document.getElementById('pet-container');
            petContainer.innerHTML = generatePetSVG(pet, mood);

            // Update mood text
            document.getElementById('pet-mood').textContent = `Your pet ${moodMessage}`;
        }

        // ==================== PARTICLE EFFECTS ====================

        function createSparkles(container, count) {
            for (let i = 0; i < count; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle-particle';
                sparkle.style.left = `${30 + Math.random() * 40}%`;
                sparkle.style.top = `${30 + Math.random() * 40}%`;
                sparkle.style.background = ['#FFD700', '#FF69B4', '#87CEEB', '#98FB98'][Math.floor(Math.random() * 4)];
                container.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 1000);
            }
        }

        function createFoodParticles(container) {
            const foods = ['ðŸŽ', 'ðŸ¥•', 'ðŸª', 'ðŸ¥¬', 'ðŸŒ¾'];
            for (let i = 0; i < 5; i++) {
                const particle = document.createElement('div');
                particle.className = 'sparkle-particle';
                particle.textContent = foods[Math.floor(Math.random() * foods.length)];
                particle.style.left = `${30 + Math.random() * 40}%`;
                particle.style.top = `${40 + Math.random() * 30}%`;
                particle.style.background = 'transparent';
                particle.style.fontSize = '1.5rem';
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }

        function createBubbles(container) {
            for (let i = 0; i < 8; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble-particle';
                bubble.style.left = `${20 + Math.random() * 60}%`;
                bubble.style.top = `${30 + Math.random() * 40}%`;
                bubble.style.animationDelay = `${Math.random() * 0.3}s`;
                container.appendChild(bubble);
                setTimeout(() => bubble.remove(), 1500);
            }
        }

        function createHearts(container) {
            for (let i = 0; i < 5; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart-particle';
                heart.textContent = 'â¤ï¸';
                heart.style.left = `${25 + Math.random() * 50}%`;
                heart.style.top = `${35 + Math.random() * 30}%`;
                heart.style.animationDelay = `${Math.random() * 0.3}s`;
                container.appendChild(heart);
                setTimeout(() => heart.remove(), 1200);
            }
        }

        function createZzz(container) {
            // Create Zzz particles
            const zzzTexts = ['Z', 'z', 'Z'];
            for (let i = 0; i < 3; i++) {
                const zzz = document.createElement('div');
                zzz.className = 'zzz-particle';
                zzz.textContent = zzzTexts[i];
                zzz.style.left = `${45 + i * 10}%`;
                zzz.style.top = `${30 + i * 5}%`;
                zzz.style.animationDelay = `${i * 0.3}s`;
                zzz.style.fontSize = `${1.5 - i * 0.2}rem`;
                container.appendChild(zzz);
                setTimeout(() => zzz.remove(), 1800);
            }
            // Create star particles
            const stars = ['â­', 'âœ¨', 'ðŸŒŸ'];
            for (let i = 0; i < 4; i++) {
                const star = document.createElement('div');
                star.className = 'star-particle';
                star.textContent = stars[Math.floor(Math.random() * stars.length)];
                star.style.left = `${20 + Math.random() * 60}%`;
                star.style.top = `${25 + Math.random() * 40}%`;
                star.style.animationDelay = `${Math.random() * 0.5}s`;
                container.appendChild(star);
                setTimeout(() => star.remove(), 1500);
            }
        }

        function createMedicineParticles(container) {
            // Gentle, friendly healing symbols - bandaids, hearts, sparkles, rainbows
            const healingSymbols = ['ðŸ©¹', 'ðŸ’•', 'âœ¨', 'ðŸŒˆ', 'ðŸ’–', 'â­'];
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'medicine-particle';
                particle.textContent = healingSymbols[i % healingSymbols.length];
                particle.style.left = `${20 + Math.random() * 60}%`;
                particle.style.top = `${25 + Math.random() * 40}%`;
                particle.style.animationDelay = `${i * 0.15}s`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 1600);
            }
        }

        function createGroomParticles(container) {
            // Grooming symbols - scissors, sparkles, nail care, bow, hearts
            const groomSymbols = ['âœ‚ï¸', 'âœ¨', 'ðŸ’«', 'ðŸ’…', 'ðŸŽ€', 'ðŸ’œ'];
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'groom-particle';
                particle.textContent = groomSymbols[i % groomSymbols.length];
                particle.style.left = `${20 + Math.random() * 60}%`;
                particle.style.top = `${25 + Math.random() * 40}%`;
                particle.style.animationDelay = `${i * 0.15}s`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 1600);
            }
        }

        function createExerciseParticles(container) {
            // Exercise symbols - running, ball, paw prints, fetch stick
            const exerciseSymbols = ['ðŸŽ¾', 'ðŸ¦´', 'ðŸ¾', 'ðŸ’¨', 'â­', 'ðŸƒ'];
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'exercise-particle';
                particle.textContent = exerciseSymbols[i % exerciseSymbols.length];
                particle.style.left = `${15 + Math.random() * 70}%`;
                particle.style.top = `${25 + Math.random() * 40}%`;
                particle.style.animationDelay = `${i * 0.12}s`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 1600);
            }
        }

        function createTreatParticles(container, treatEmoji) {
            // Treat symbols - the chosen treat plus sparkles, stars, hearts
            const symbols = [treatEmoji, 'âœ¨', 'â­', 'ðŸ’–', treatEmoji, 'ðŸŒŸ'];
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'treat-particle';
                particle.textContent = symbols[i % symbols.length];
                particle.style.left = `${15 + Math.random() * 70}%`;
                particle.style.top = `${20 + Math.random() * 45}%`;
                particle.style.animationDelay = `${i * 0.12}s`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 1700);
            }
        }

        function createCuddleParticles(container) {
            // Cuddle symbols - hearts, sparkles, warm emojis
            const cuddleSymbols = ['ðŸ’•', 'ðŸ’—', 'âœ¨', 'ðŸ¥°', 'ðŸ’–', 'ðŸ’›'];
            for (let i = 0; i < 7; i++) {
                const particle = document.createElement('div');
                particle.className = 'cuddle-particle';
                particle.textContent = cuddleSymbols[i % cuddleSymbols.length];
                particle.style.left = `${15 + Math.random() * 70}%`;
                particle.style.top = `${20 + Math.random() * 45}%`;
                particle.style.animationDelay = `${i * 0.1}s`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 1700);
            }
        }

        // ==================== DECAY TIMER ====================

        let decayInterval = null;
        let lastDecayAnnouncement = 0;

        function startDecayTimer() {
            if (decayInterval) clearInterval(decayInterval);

            // Decrease needs every 30 seconds (gentle for young children)
            decayInterval = setInterval(() => {
                if (gameState.phase === 'pet' && gameState.pet && !document.hidden) {
                    const pet = gameState.pet;
                    pet.hunger = clamp(pet.hunger - 1, 0, 100);
                    pet.cleanliness = clamp(pet.cleanliness - 1, 0, 100);
                    pet.happiness = clamp(pet.happiness - 1, 0, 100);
                    pet.energy = clamp(pet.energy - 1, 0, 100);

                    // Update time of day and refresh display if changed
                    const newTimeOfDay = getTimeOfDay();
                    if (gameState.timeOfDay !== newTimeOfDay) {
                        gameState.timeOfDay = newTimeOfDay;
                        updateDayNightDisplay();
                    }

                    updateNeedDisplays();
                    updatePetMood();
                    saveGame();

                    // Gentle reminders at low levels (no negative messages)
                    // But don't spam - only announce every 2 minutes max
                    const now = Date.now();
                    if (now - lastDecayAnnouncement > 120000) {
                        const mood = getMood(pet);
                        if (mood === 'sad') {
                            const lowestNeed = Math.min(pet.hunger, pet.cleanliness, pet.happiness, pet.energy);
                            if (lowestNeed <= 20) {
                                let needName = '';
                                if (pet.hunger === lowestNeed) needName = 'hungry';
                                else if (pet.cleanliness === lowestNeed) needName = 'needs a bath';
                                else if (pet.energy === lowestNeed) needName = 'tired and needs sleep';
                                else needName = 'wants to play';
                                announce(`Your pet is ${needName}! Can you help?`);
                                lastDecayAnnouncement = now;
                            }
                        }
                    }
                }
            }, 30000); // Every 30 seconds
        }

        function updateDayNightDisplay() {
            const petArea = document.querySelector('.pet-area');
            if (!petArea) return;

            const timeOfDay = gameState.timeOfDay;
            const timeClass = timeOfDay === 'day' ? 'daytime' : timeOfDay === 'night' ? 'nighttime' : timeOfDay;

            // Update class
            petArea.classList.remove('daytime', 'nighttime', 'sunset', 'sunrise');
            petArea.classList.add(timeClass);

            // Update time indicator
            const timeIndicator = petArea.querySelector('.time-indicator');
            if (timeIndicator) {
                timeIndicator.textContent = getTimeIcon(timeOfDay);
                timeIndicator.setAttribute('aria-label', `Time: ${timeOfDay}`);
            }

            // Update celestial elements
            const existingStars = petArea.querySelector('.stars-overlay');
            const existingMoon = petArea.querySelector('.moon');
            const existingSun = petArea.querySelector('.sun');

            if (existingStars) existingStars.remove();
            if (existingMoon) existingMoon.remove();
            if (existingSun) existingSun.remove();

            if (timeOfDay === 'night') {
                const starsOverlay = document.createElement('div');
                starsOverlay.className = 'stars-overlay';
                starsOverlay.innerHTML = generateStarsHTML();
                petArea.insertBefore(starsOverlay, petArea.firstChild);

                const moon = document.createElement('div');
                moon.className = 'moon';
                petArea.insertBefore(moon, petArea.children[1]);
            } else if (timeOfDay === 'day') {
                const sun = document.createElement('div');
                sun.className = 'sun';
                petArea.insertBefore(sun, petArea.firstChild);
            }
        }

        function stopDecayTimer() {
            if (decayInterval) {
                clearInterval(decayInterval);
                decayInterval = null;
            }
        }

        // ==================== VISIBILITY HANDLING ====================

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden, save current state
                saveGame();
            } else {
                // Page is visible again, apply any decay that occurred while away
                if (gameState.phase === 'pet' && gameState.pet) {
                    const saved = loadGame();
                    if (saved && saved.pet) {
                        gameState.pet.hunger = saved.pet.hunger;
                        gameState.pet.cleanliness = saved.pet.cleanliness;
                        gameState.pet.happiness = saved.pet.happiness;
                        updateNeedDisplays();
                        updatePetMood();
                    }
                }
            }
        });

        // ==================== MODAL ====================

        function showModal(title, message, icon, onConfirm, onCancel) {
            // Remove any existing modal
            const existingModal = document.querySelector('.modal-overlay');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.setAttribute('role', 'dialog');
            modal.setAttribute('aria-modal', 'true');
            modal.setAttribute('aria-labelledby', 'modal-title');

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-icon" aria-hidden="true">${icon}</div>
                    <h2 class="modal-title" id="modal-title">${title}</h2>
                    <p class="modal-message">${message}</p>
                    <div class="modal-buttons">
                        <button class="modal-btn cancel" id="modal-cancel">
                            No, Keep Pet
                        </button>
                        <button class="modal-btn confirm" id="modal-confirm">
                            Yes, New Egg
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            const confirmBtn = document.getElementById('modal-confirm');
            const cancelBtn = document.getElementById('modal-cancel');

            // Focus the cancel button (safer option for children)
            cancelBtn.focus();

            function closeModal() {
                modal.remove();
            }

            confirmBtn.addEventListener('click', () => {
                closeModal();
                if (onConfirm) onConfirm();
            });

            cancelBtn.addEventListener('click', () => {
                closeModal();
                if (onCancel) onCancel();
            });

            // Close on overlay click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                    if (onCancel) onCancel();
                }
            });

            // Handle Escape key
            function handleEscape(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    if (onCancel) onCancel();
                    document.removeEventListener('keydown', handleEscape);
                }
            }
            document.addEventListener('keydown', handleEscape);

            // Trap focus within modal
            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    const focusable = modal.querySelectorAll('button');
                    const first = focusable[0];
                    const last = focusable[focusable.length - 1];

                    if (e.shiftKey && document.activeElement === first) {
                        e.preventDefault();
                        last.focus();
                    } else if (!e.shiftKey && document.activeElement === last) {
                        e.preventDefault();
                        first.focus();
                    }
                }
            });

            announce(title + '. ' + message);
        }

        // ==================== NEW PET ====================

        function startNewPet() {
            showModal(
                'New Pet?',
                'Say bye-bye to your pet and get a new egg?',
                'ðŸ¥š',
                () => {
                    // Clear the decay timer
                    if (decayInterval) {
                        clearInterval(decayInterval);
                        decayInterval = null;
                    }

                    gameState = {
                        phase: 'egg',
                        pet: null,
                        eggTaps: 0,
                        lastUpdate: Date.now(),
                        timeOfDay: getTimeOfDay()
                    };
                    saveGame();
                    announce('Starting fresh with a new egg!', true);
                    renderEggPhase();
                },
                () => {
                    // User cancelled, focus back on the new pet button
                    const newPetBtn = document.getElementById('new-pet-btn');
                    if (newPetBtn) newPetBtn.focus();
                }
            );
        }

        // ==================== INITIALIZATION ====================

        function init() {
            // Stop any existing timers
            stopDecayTimer();

            const saved = loadGame();
            if (saved) {
                gameState = saved;
            }

            if (gameState.phase === 'pet' && gameState.pet) {
                renderPetPhase();
                const petData = PET_TYPES[gameState.pet.type];
                const mood = getMood(gameState.pet);
                const moodGreeting = mood === 'happy' ? 'is so happy to see you!' :
                                     mood === 'sad' ? 'missed you and needs some care!' :
                                     'is glad you\'re back!';
                announce(`Welcome back! Your ${petData.name} ${moodGreeting}`);
            } else {
                // Reset to egg phase if not in pet phase
                gameState.phase = 'egg';
                gameState.eggTaps = gameState.eggTaps || 0;
                renderEggPhase();
                announce('Welcome to Pet Care Buddy! Tap the egg to hatch your new pet!');
            }
        }

        // Start the game when page loads
        document.addEventListener('DOMContentLoaded', init);

        // Save and cleanup on page unload
        window.addEventListener('beforeunload', () => {
            saveGame();
            stopDecayTimer();
        });

        // Also handle page hide for mobile browsers
        window.addEventListener('pagehide', () => {
            saveGame();
        });
    </script>
</body>
</html>
